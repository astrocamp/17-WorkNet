{% extends "layouts/base.html" %}
{% load markdown %}
{% block content %}
<div class="relative flex items-center justify-center overflow-hidden text-center h-44 md:h-80 lg:h-80">
    <h1 class="relative z-20 text-3xl font-bold text-white md:text-5xl lg:text-5xl">{{ post.title }}</h1>
    <div class="absolute inset-0 z-10 m-auto bg-fixed bg-center bg-cover bg-banner-img"></div>
    <div class="absolute z-10 m-auto inset-0 bg-gradient-to-b from-[rgba(68,157,209,0.9)] to-[rgba(0,51,107,0.9)]"></div>
</div>
<div class="container p-5 pb-24 mx-auto">
    <div class="flex items-start gap-2 pb-2 border-gray-300">
        <div>
            <i class="pt-2 fas fa-user-circle fa-2xl"></i>
        </div>
        <div>
            <div class="text-xl">{{ post.user }}</div>
            <div class="text-xs font-light">{{ post.created_at|date:"Y/m/d H:i" }}</div>
        </div>
        <div class="flex items-center gap-2 ml-auto">
            {% if is_author %}
            <a class="text-white btn btn-primary" href="{% url 'posts:edit' post.id %}">編輯評論</a>
            {% endif %}
            <a class="text-white btn btn-neutral" href="{% url 'companies:post_index' post.company.id %}">回到列表</a>
        </div>
    </div>
    <div class="p-5 mt-2 bg-gray-100 rounded-lg">
        <div class="flex justify-between">
            <div class="flex flex-col">
                <span class="text-sm font-semibold text-gray-600">整體評分</span>
                <div class="flex mt-2">
                    {% with stars=5 %}
                        {% for i in "01234" %}
                            {% if forloop.counter <= post.score %}
                                <i class="fa-solid fa-star fa-xl" style="color: #FFD43B;"></i>
                            {% else %}
                                <i class="fa-regular fa-star fa-xl" style="color: #FFD43B;"></i>
                            {% endif %}
                        {% endfor %}
                    {% endwith %}
                </div>
            </div>
            <div class="flex items-center">
                {% include "posts/like.html" with post=post %}
            </div>
        </div>
    </div>
    <div class="py-4 markdown-body">{{ post.content|convert_markdown|safe }}</div><br>
    <section class="p-5 mt-2 border border-gray-300 rounded-2xl">
        <h3 class="pb-5 mb-5 text-xl font-bold border-b border-gray-300">留言</h3>
        {% if comments %}
            <ul id="comments" class="space-y-4">
                {% for comment in comments %}
                    {% include 'posts/comment.html' with comment=comment request=request only %}
                {% endfor %}
            </ul>
        {% else %}
            <ul id="comments" class="space-y-4">
                <li id="remove_no_comment" class="text-center text-gray-400">尚無回覆</li>
            </ul>
        {% endif %}

        {% if user.is_authenticated %}
        <div class="mt-6">
            <form
                hx-target="#comments"
                hx-swap="afterbegin"
                hx-confirm="確認送出留言？"
                hx-on::after-request="this.reset();"
                hx-post="{% url 'posts:show' post.id %}">
                {% csrf_token %}
                {{ comment_form.as_p }}
                <button  class="text-white btn btn-primary" type="submit">確定</button>
            </form>
        </div>
        {% else %}
        <p class="text-red-500">登入後即可一起討論！</p>
        <a class="text-white btn btn-secondary" href="{% url 'users:sign_in' %}?next={{ request.path }}">登入</a>
        {% endif %}
    </section>

    <div class="mt-6">
        <span class="text-white btn btn-neutral" onclick="history.back();">回到列表</span>
    </div>
</div>
{% endblock %}
